<Doctype HTML>
<HTML>
	<head>
		<meta charset="utf-8">
		<title>Name That Player!</title>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.2/jquery.min.js"></script>
		<link rel="icon" type="image/png" href="public/favicon-96x96.png" sizes="96x96">
  		<link rel="stylesheet" href="http://netdna.bootstrapcdn.com/bootstrap/3.0.0/css/bootstrap.min.css"> 
  		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css"> 
  		<link rel="stylesheet" type="text/css" href="style.css">  

		<script>
			var playerCounter = 0;
			var currPlayer;
			var nextPlayer;
			var playerList = [];
			var score = 0;
			function init() {
				var i = 10;
		  		var timer = setInterval(function() { 
		  			i--;
		  			$('#timer').html("Seconds Left: " + i);
		  			if(i === 0) {
		  				$('#main').html('<h1>You got ' + score + ' points!</h1>');
		  				$('#main').append('<br><button onclick="init()">Play Again?</button>');
		  				clearInterval(timer);
		  			} 
		  		}, 1000);
				$.ajax({
				  url: '/JSONreq',
				  complete: function(data) {
				    playerList = data.responseJSON.playerList;
				    console.log(data);
				    currPlayer = playerList[Math.floor(playerList.length * Math.random())];
				    nextPlayer = playerList[Math.floor(playerList.length * Math.random())];
				    //$('#img').css({'background-image': 'url(' + nextPlayer.url + ')'});
				    $('#img').html("<img id='" + playerCounter + "' src=' " + currPlayer.url +"' onError=newPlayer(false)>");
				    playerCounter++;
				    $('#img').append("<img id='" + playerCounter + "' src=' " + nextPlayer.url +"' style='display:none' onError=newPlayer(false)>");
				  }
				});
			}
			init();
			//Load up 2 players at a time so there are smooth transitions
			function newPlayer(pass){ 
					$('#' + playerCounter).show();
					$('#' + (playerCounter - 1) ).remove(); 
					currPlayer = nextPlayer;
					var randIndex = Math.floor(playerList.length * Math.random());
					nextPlayer = playerList[randIndex];
					console.log(currPlayer);
					if(!pass) {
						playerList.splice(randIndex, 1); //Take player out of remaining players if the player passed
					}
					$('#img').html("<img id='" + playerCounter + "' src=' " + currPlayer.url +"' onError=newPlayer(false)>");
				    playerCounter++;
				    $('#img').append("<img id='" + playerCounter + "' src=' " + nextPlayer.url +"' style='display:none' onError=newPlayer(false)>");

			}
			function check() {
				var guess = $('input').val().toLowerCase();
				var answer = currPlayer.name.toLowerCase();
				//Allow user to also put in last name
				var lastNameGuessArray = guess.split(" ");
				var lastNameArray = answer.split(" ");
				console.log(lastNameGuessArray);
				console.log(lastNameArray);
				var lastNameGuess = "";
				var lastName = "";
				for(var i = 0; i < lastNameArray.length; i++) {
					lastNameGuess +=lastNameGuessArray[i];
					lastName += lastNameArray[i+1];
				}
				console.log(guess);
				console.log(answer);
				console.log(lastNameGuess);
				console.log(lastName);
				if(guess === answer || lastNameGuess === lastName) {
					newPlayer(false);
					score+=1;
					$('#score').html("Score: " + score);
				} else {
					//Indicate wrong name by flashing or something
				}
				$('input').val('');
			}
			window.addEventListener('keydown', function(e) {
				if (e.keyCode === 13) {
					check();
				}
				// if (e.keyCode === 16) {
				// 	newPlayer(true);
				// }
			});
		</script>
	</head>
	<body>
		<h1>Name That Player!</h1>
		<div id='main'>
			<div id="timer"></div><br>
			<div id="img"></div><br>
			<input type="text"><br>
			<button onclick="check()">Enter</button>
			<button onclick="newPlayer(true)">Pass</button>	
			<div id="score">Score: 0</div>
		</div>
	</body>
<HTML>